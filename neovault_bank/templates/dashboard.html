{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - NeoVault Bank{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dashboard-style.css' %}">
<style>
    .dashboard-container {
        display: flex;
        min-height: 100vh;
        background: var(--light-color);
    }
    
    .dashboard-sidebar {
        width: 280px;
        background: var(--card-bg);
        box-shadow: 2px 0 10px var(--shadow-color);
        position: fixed;
        height: 100vh;
        overflow-y: auto;
        z-index: 1000;
    }
    
    .dashboard-main {
        flex: 1;
        margin-left: 280px;
        padding: 20px;
    }
    
    .dashboard-header {
        background: var(--card-bg);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 5px 15px var(--shadow-color);
        margin-bottom: 30px;
    }
    
    .dashboard-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .stat-card {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 25px;
        border-radius: 12px;
        text-align: center;
    }
    
    .stat-card h3 {
        font-size: 2rem;
        margin-bottom: 10px;
        font-weight: 800;
    }
    
    .quick-actions {
        background: var(--card-bg);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 5px 15px var(--shadow-color);
        margin-bottom: 30px;
    }
    
    .action-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .action-card {
        background: var(--light-color);
        padding: 25px 15px;
        border-radius: 12px;
        text-align: center;
        text-decoration: none;
        color: var(--text-color);
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }
    
    .action-card:hover {
        transform: translateY(-5px);
        border-color: var(--accent-color);
        text-decoration: none;
        color: var(--text-color);
    }
    
    .action-card i {
        font-size: 2rem;
        color: var(--primary-color);
        margin-bottom: 15px;
    }
    
    .accounts-section, .transactions-section {
        background: var(--card-bg);
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 5px 15px var(--shadow-color);
        margin-bottom: 30px;
    }
    
    .accounts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .account-card {
        background: var(--light-color);
        padding: 25px;
        border-radius: 12px;
        border-left: 4px solid var(--accent-color);
    }
    
    .account-number {
        color: var(--secondary-color);
        font-family: monospace;
        margin-bottom: 10px;
    }
    
    .balance {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-color);
    }
    
    .transactions-list {
        margin-top: 20px;
    }
    
    .transaction-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background: var(--light-color);
        border-radius: 10px;
        margin-bottom: 15px;
        border-left: 4px solid var(--success-color);
    }
    
    .transaction-item.withdrawal {
        border-left-color: var(--danger-color);
    }
    
    .transaction-info h5 {
        margin-bottom: 5px;
    }
    
    .transaction-amount {
        font-weight: 700;
        font-size: 1.1rem;
    }
    
    .transaction-item.deposit .transaction-amount {
        color: var(--success-color);
    }
    
    .transaction-item.withdrawal .transaction-amount {
        color: var(--danger-color);
    }
    
    .sidebar-header {
        padding: 30px 20px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        text-align: center;
    }
    
    .sidebar-header .user-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin: 0 auto 15px;
        border: 3px solid white;
        overflow: hidden;
    }
    
    .sidebar-header .user-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .sidebar-nav {
        padding: 20px 0;
    }
    
    .nav-item {
        margin-bottom: 5px;
    }
    
    .nav-link {
        display: flex;
        align-items: center;
        padding: 15px 25px;
        color: var(--text-color);
        text-decoration: none;
        transition: all 0.3s ease;
        border-left: 3px solid transparent;
    }
    
    .nav-link:hover, .nav-link.active {
        background: var(--light-color);
        color: var(--primary-color);
        border-left-color: var(--accent-color);
    }
    
    .nav-link i {
        width: 25px;
        margin-right: 15px;
        font-size: 1.1rem;
    }
    
    @media (max-width: 768px) {
        .dashboard-sidebar {
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .dashboard-sidebar.mobile-open {
            transform: translateX(0);
        }
        
        .dashboard-main {
            margin-left: 0;
        }
        
        .mobile-menu-toggle {
            display: block;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: var(--primary-color);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Dashboard Sidebar -->
    {% include 'partials/dashboard_sidebar.html' %}
    
    <!-- Main Content -->
    <div class="dashboard-main">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle" style="display: none;">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <h1>Welcome back, {{ user.first_name|default:user.username }}!</h1>
            <p class="text-muted">Here's your financial overview for today</p>
            
            <div class="dashboard-stats">
                <div class="stat-card">
                    <h3>${{ total_balance|floatformat:2 }}</h3>
                    <p>Total Balance</p>
                </div>
                <div class="stat-card">
                    <h3>{{ accounts.count }}</h3>
                    <p>Accounts</p>
                </div>
                <div class="stat-card">
                    <h3>{{ credit_cards.count }}</h3>
                    <p>Credit Cards</p>
                </div>
                <div class="stat-card">
                    <h3>{{ bills.count }}</h3>
                    <p>Pending Bills</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h2>Quick Actions</h2>
            <div class="action-grid">
                <a href="{% url 'deposit' %}" class="action-card">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>Deposit</span>
                </a>
                <a href="{% url 'withdraw' %}" class="action-card">
                    <i class="fas fa-hand-holding-usd"></i>
                    <span>Withdraw</span>
                </a>
                <a href="{% url 'transfer' %}" class="action-card">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Transfer</span>
                </a>
                <a href="{% url 'bills' %}" class="action-card">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Pay Bills</span>
                </a>
                <a href="{% url 'credit_cards' %}" class="action-card">
                    <i class="fas fa-credit-card"></i>
                    <span>Credit Cards</span>
                </a>
                <a href="{% url 'savings_goals' %}" class="action-card">
                    <i class="fas fa-bullseye"></i>
                    <span>Savings Goals</span>
                </a>
            </div>
        </div>

        <div class="row">
            <!-- Accounts Overview -->
            <div class="col-lg-6">
                <div class="accounts-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Your Accounts</h2>
                        <a href="#" class="btn btn-outline-primary btn-sm">View All</a>
                    </div>
                    <div class="accounts-grid">
                        {% for account in accounts %}
                        <div class="account-card">
                            <h4>{{ account.get_account_type_display }}</h4>
                            <p class="account-number">{{ account.account_number }}</p>
                            <p class="balance">${{ account.balance|floatformat:2 }}</p>
                            <div class="mt-3">
                                <small class="text-muted">Last updated: {{ account.created_at|date:"M d, Y" }}</small>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center">
                            <p>No accounts found.</p>
                            <a href="#" class="btn btn-primary">Open New Account</a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Recent Transactions -->
            <div class="col-lg-6">
                <div class="transactions-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Recent Transactions</h2>
                        <a href="#" class="btn btn-outline-primary btn-sm">View All</a>
                    </div>
                    <div class="transactions-list">
                        {% for transaction in transactions %}
                        <div class="transaction-item {% if transaction.transaction_type == 'withdrawal' %}withdrawal{% else %}deposit{% endif %}">
                            <div class="transaction-info">
                                <h5>{{ transaction.get_transaction_type_display }}</h5>
                                <p class="text-muted mb-0">{{ transaction.description }}</p>
                                <small class="text-muted">{{ transaction.timestamp|date:"M d, Y H:i" }}</small>
                            </div>
                            <div class="transaction-amount">
                                {% if transaction.transaction_type == 'deposit' %}+{% else %}-{% endif %}${{ transaction.amount|floatformat:2 }}
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-4">
                            <i class="fas fa-exchange-alt fa-3x text-muted mb-3"></i>
                            <p>No transactions yet</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Dashboard Sections -->
        <div class="row">
            <!-- Credit Cards -->
            <div class="col-lg-6">
                <div class="accounts-section">
                    <h2>Credit Cards</h2>
                    <div class="accounts-grid">
                        {% for card in credit_cards %}
                        <div class="account-card">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <h4>{{ card.get_card_type_display }}</h4>
                                <span class="badge bg-success">Active</span>
                            </div>
                            <p class="account-number">**** **** **** {{ card.card_number|slice:"-4:" }}</p>
                            <p class="balance">${{ card.available_credit|floatformat:2 }}</p>
                            <small class="text-muted">Credit Limit: ${{ card.credit_limit|floatformat:2 }}</small>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center">
                            <p>No credit cards found.</p>
                            <a href="{% url 'credit_cards' %}" class="btn btn-primary">Apply for Card</a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Savings Goals -->
            <div class="col-lg-6">
                <div class="accounts-section">
                    <h2>Savings Goals</h2>
                    <div class="accounts-grid">
                        {% for goal in savings_goals %}
                        <div class="account-card">
                            <h4>{{ goal.name }}</h4>
                            <div class="progress mb-3">
                                <div class="progress-bar bg-success" style="width: {{ goal.progress_percentage }}%">
                                    {{ goal.progress_percentage|floatformat:0 }}%
                                </div>
                            </div>
                            <p class="balance">${{ goal.current_amount|floatformat:2 }} / ${{ goal.target_amount|floatformat:2 }}</p>
                            <small class="text-muted">Target: {{ goal.target_date|date:"M d, Y" }}</small>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center">
                            <p>No savings goals set.</p>
                            <a href="{% url 'savings_goals' %}" class="btn btn-primary">Set a Goal</a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Mobile menu toggle
    document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const dashboardSidebar = document.querySelector('.dashboard-sidebar');
        
        if (window.innerWidth <= 768) {
            mobileMenuToggle.style.display = 'block';
            
            mobileMenuToggle.addEventListener('click', function() {
                dashboardSidebar.classList.toggle('mobile-open');
            });
            
            // Close sidebar when clicking outside
            document.addEventListener('click', function(e) {
                if (!dashboardSidebar.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
                    dashboardSidebar.classList.remove('mobile-open');
                }
            });
        }
        
        // Update mobile menu on resize
        window.addEventListener('resize', function() {
            if (window.innerWidth <= 768) {
                mobileMenuToggle.style.display = 'block';
            } else {
                mobileMenuToggle.style.display = 'none';
                dashboardSidebar.classList.remove('mobile-open');
            }
        });
    });
</script>
{% endblock %}